<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="DMA（Direct Memory Access，直接内存访问）是一种数据传输机制，它允许嵌入式系统中的外设在无需CPU干预的情况下，直接与内存之间进行数据交换。 DMA 传输方式DMA的作用就是实现数据的直接传输，而去掉了传统数据传输需要CPU寄存器参与的环节，主要涉及四种情况的数据传输，但本质上是一样的，都是从内存的某一区域传输到内存的另一区域（外设的数据寄存器本质上就是内存的一个存储单元）。">
<meta property="og:type" content="article">
<meta property="og:title" content="DMA">
<meta property="og:url" content="https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/index.html">
<meta property="og:site_name" content="流年不知心底事">
<meta property="og:description" content="DMA（Direct Memory Access，直接内存访问）是一种数据传输机制，它允许嵌入式系统中的外设在无需CPU干预的情况下，直接与内存之间进行数据交换。 DMA 传输方式DMA的作用就是实现数据的直接传输，而去掉了传统数据传输需要CPU寄存器参与的环节，主要涉及四种情况的数据传输，但本质上是一样的，都是从内存的某一区域传输到内存的另一区域（外设的数据寄存器本质上就是内存的一个存储单元）。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407DMAsangechuanshuliu.png">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407DMAwoshoujizhi.png">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407DMAkuangtu.png">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407DMAtongdaoyinshe.png">
<meta property="article:published_time" content="2024-11-02T08:38:00.000Z">
<meta property="article:modified_time" content="2025-01-07T10:58:33.648Z">
<meta property="article:author" content="kay">
<meta property="article:tag" content="GD32F407">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407DMAsangechuanshuliu.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>DMA</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">博主</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98/C%E8%AF%AD%E8%A8%80/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/SPI/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&text=DMA"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&title=DMA"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&is_video=false&description=DMA"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=DMA&body=Check out this article: https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&title=DMA"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&title=DMA"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&title=DMA"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&title=DMA"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&name=DMA&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&t=DMA"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#DMA-%E4%BC%A0%E8%BE%93%E6%96%B9%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">DMA 传输方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DMA-%E4%B8%89%E7%A7%8D%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-number">1.1.</span> <span class="toc-text">DMA 三种传输模式的数据流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%AE%BE%E6%8F%A1%E6%89%8B"><span class="toc-number">1.2.</span> <span class="toc-text">外设握手</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">传输模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DMA-%E5%8F%82%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">DMA 参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DMA-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">DMA 执行流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DMA-%E9%80%9A%E9%81%93%E6%98%A0%E5%B0%84%E8%A1%A8"><span class="toc-number">5.</span> <span class="toc-text">DMA 通道映射表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">传输控制器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">7.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E"><span class="toc-number">7.2.</span> <span class="toc-text">说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">8.</span> <span class="toc-text">问题</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        DMA
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">kay</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-11-02T08:38:00.000Z" class="dt-published" itemprop="datePublished">2024-11-02</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/ARM/">ARM</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/GD32F407/" rel="tag">GD32F407</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p><strong>DMA（Direct Memory Access，直接内存访问）</strong>是一种数据传输机制，它允许嵌入式系统中的外设在无需CPU干预的情况下，直接与内存之间进行数据交换。</p>
<h2 id="DMA-传输方式"><a href="#DMA-传输方式" class="headerlink" title="DMA 传输方式"></a>DMA 传输方式</h2><p>DMA的作用就是实现数据的直接传输，而去掉了传统数据传输需要CPU寄存器参与的环节，主要涉及四种情况的数据传输，但本质上是一样的，都是从内存的某一区域传输到内存的另一区域（外设的数据寄存器本质上就是内存的一个存储单元）。四种情况的数据传输如下：</p>
<p><strong>内存到内存（Memory-to-Memory）</strong>：数据在内存之间传输。</p>
<p><strong>外设到内存（Peripheral-to-Memory）</strong>：将外设数据写入内存。</p>
<p><strong>内存到外设（Memory-to-Peripheral）</strong>：将内存数据写入外设。</p>
<p><strong>外设到外设（Peripheral-to-Peripheral）</strong>：将外设数据写入外设。</p>
<blockquote>
<p>外设到外设的方式可以理解成内存到内存，因为 DMA 的传输模式本身其实并不存在外设到外设这种传输方式；</p>
</blockquote>
<h3 id="DMA-三种传输模式的数据流"><a href="#DMA-三种传输模式的数据流" class="headerlink" title="DMA 三种传输模式的数据流"></a>DMA 三种传输模式的数据流</h3><p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407DMAsangechuanshuliu.png" alt="F407DMAsangechuanshuliu.png"></p>
<ul>
<li>外设到存储器：通过 AHB 外设主机接口从外设读取数据，通过 AHB 存储器主机接口向存 储器写入数据；</li>
<li>存储器到外设：通过 AHB 存储器主机接口从存储器读取数据，通过 AHB 外设主机接口向 外设写入数据；</li>
<li>存储器到存储器：通过 AHB 外设主机接口从存储器读取数据，通过 AHB 存储器主机接口 向存储器写入数据。</li>
</ul>
<h3 id="外设握手"><a href="#外设握手" class="headerlink" title="外设握手"></a>外设握手</h3><p>为了保证数据的有效传输，DMA 控制器中引入了外设和存储器的握手机制，包括请求信号和应 答信号：</p>
<ul>
<li><strong>请求信号：</strong>由外设发出，表明外设已经准备好发送或接收数据；</li>
<li><strong>应答信号：</strong>由 DMA 控制器响应，表明 DMA 控制器已经发送 AHB 命令去访问外设。</li>
</ul>
<p><strong>握手机制</strong></p>
<p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407DMAwoshoujizhi.png" alt="F407DMAwoshoujizhi"></p>
<h2 id="传输模式"><a href="#传输模式" class="headerlink" title="传输模式"></a>传输模式</h2><p>支持单数据传输和多数据传输模式：</p>
<ul>
<li><strong>多数据传输模式：</strong>在存储器数据宽度和外设数据宽度不同的时候，自动打包&#x2F;解包数据；</li>
<li><strong>单数据传输模式：</strong>当且仅当 FIFO 空的时候从源地址读取数据，存进 FIFO，然后把 FIFO 的数据写到目标地址。</li>
</ul>
<p><strong>FIFO</strong></p>
<p>DMA 控制器的每个通道都有一个 4 字深度的 FIFO 用于缓冲数据，从源地址读取的数据会先暂时保存在 FIFO 中，再传输到目的地址。根据 FIFO 的配置，DMA 控制器支持两种数据处理模式： 单数据传输模式和多数据传输模式。<strong>在存储器到存储器模式下，DMA 控制器仅支持多数据传输 模式。</strong></p>
<h2 id="DMA-参数"><a href="#DMA-参数" class="headerlink" title="DMA 参数"></a>DMA 参数</h2><p>在使用DMA时，通常需要配置以下主要参数：</p>
<ul>
<li><p><strong>direction（传输方向）</strong></p>
<ul>
<li>定义 DMA 数据传输的方向，有以下几种选项：<ul>
<li>DMA_PERIPH_TO_MEMORY: 从外设传输到内存。</li>
<li>DMA_MEMORY_TO_PERIPH: 从内存传输到外设。</li>
<li>DMA_MEMORY_TO_MEMORY: 从内存传输到内存（一些 DMA 控制器可能不支持）。</li>
</ul>
</li>
</ul>
<p><strong>periph_addr（外设地址）</strong></p>
<ul>
<li>设置 DMA 读取数据的源地址，通常是外设的寄存器地址（如 USART 的数据寄存器地址）。这个地址通常是固定的，不会变化。</li>
</ul>
<p><strong>memory0_addr（内存地址）</strong></p>
<ul>
<li>设置 DMA 将数据传输到的内存地址，或者在读取模式下 DMA 从此内存地址获取数据传输到外设。这个地址在递增模式下会自动递增。</li>
</ul>
<p><strong>periph_inc（外设地址递增模式）</strong></p>
<ul>
<li>设置外设地址是否递增：<ul>
<li>DMA_PERIPH_INCREASE_ENABLE: 每次传输后外设地址递增。</li>
<li>DMA_PERIPH_INCREASE_DISABLE: 外设地址保持不变（常用）。</li>
</ul>
</li>
</ul>
<p><strong>memory_inc（内存地址递增模式）</strong></p>
<ul>
<li>设置内存地址是否递增：<ul>
<li>DMA_MEMORY_INCREASE_ENABLE: 每次传输后内存地址递增。</li>
<li>DMA_MEMORY_INCREASE_DISABLE: 内存地址保持不变。</li>
</ul>
</li>
</ul>
<p><strong>periph_memory_width（数据宽度）</strong></p>
<ul>
<li>定义传输的数据宽度，有以下几种选择：<ul>
<li>DMA_PERIPH_WIDTH_8BIT: 8 位传输（字节 Byte, 8位）。</li>
<li>DMA_PERIPH_WIDTH_16BIT: 16 位传输（半字 Half-word, 16位）。</li>
<li>DMA_PERIPH_WIDTH_32BIT: 32 位传输（字 Word, 32位）。</li>
</ul>
</li>
</ul>
<p><strong>circular_mode（循环模式）</strong></p>
<ul>
<li>定义 DMA 传输是否启用循环模式：<ul>
<li>DMA_CIRCULAR_MODE_ENABLE: 启用循环模式，在传输完指定数据量后自动重新开始。</li>
<li>DMA_CIRCULAR_MODE_DISABLE: 禁用循环模式，传输一次完成后停止。</li>
</ul>
</li>
</ul>
<p><strong>priority（优先级）</strong></p>
<ul>
<li>设置 DMA 通道的优先级：<ul>
<li>DMA_PRIORITY_LOW: 低优先级。</li>
<li>DMA_PRIORITY_MEDIUM: 中等优先级。</li>
<li>DMA_PRIORITY_HIGH: 高优先级。</li>
<li>DMA_PRIORITY_VERY_HIGH: 最高优先级。</li>
</ul>
</li>
</ul>
<p><strong>number（传输数据量）</strong></p>
<ul>
<li>设置 DMA 传输的数据项数量（如传输多少个字节或字）。DMA 会根据这个数量确定何时完成传输。</li>
</ul>
</li>
</ul>
<h2 id="DMA-执行流程"><a href="#DMA-执行流程" class="headerlink" title="DMA 执行流程"></a>DMA 执行流程</h2><p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407DMAkuangtu.png" alt="F407DMAkuangtu"></p>
<p>USART 向 DMA 请求传输数据的完整流程：</p>
<ol>
<li><strong>USART 外设触发 DMA 请求</strong></li>
</ol>
<ul>
<li>在 APB 总线上的 USART 外设在准备好要<strong>发送</strong>或<strong>接收</strong>的数据时，会<strong>向 DMA 控制器发出 DMA 请求信号</strong>。这个请求信号通过总线桥传递到 DMA 控制器。</li>
</ul>
<ol start="2">
<li><strong>DMA 控制器接收请求</strong></li>
</ol>
<ul>
<li>USART 的 DMA 请求到达相应的 DMA 控制器时，该 DMA 控制器会根据预设配置选择合适的 DMA 通道进行数据传输。</li>
<li>“仲裁器”会根据通道的优先级判断哪个通道的请求优先执行。仲裁器确保当多个通道请求同时发生时，高优先级的请求优先得到处理。</li>
</ul>
<ol start="3">
<li><strong>DMA 控制器将数据搬运到内存</strong></li>
</ol>
<ul>
<li><p>DMA 控制器根据配置将数据从 USART 的数据寄存器搬运到指定的内存地址。这个过程利用 AHB 总线进行数据传输。</p>
</li>
<li><p>如果是“外设到内存”模式，DMA 会从 USART 数据寄存器读取数据并写入到 SRAM 的指定内存地址。</p>
</li>
</ul>
<ol start="4">
<li><strong>地址和传值自动更新</strong></li>
</ol>
<ul>
<li>每次搬运一个字节或字的数据后，DMA 会根据配置选择是否递增内存地址。对于连续数据搬运，通常设置内存地址递增，而外设地址保持不变，因为数据总是从 USART 的同一个数据寄存器读取。</li>
<li>传输过程中，外设每传输一次数据，CNT 减 1。如果寄存 器 DMA_CHxCTL 的 CMEN 位或 SBMEN 位置 1，在每次传输完成时，CNT会由硬件自动重新装载。</li>
</ul>
<ol start="5">
<li><strong>传输完成或中途抢占</strong></li>
</ol>
<ul>
<li><p>DMA 会持续传输，直到传输的字节数达到预设值。如果在传输过程中有更高优先级的 DMA 请求发起（如来自另一个 USART 或其他外设），高优先级请求可以中断当前传输并优先完成。</p>
</li>
<li><p>当所有预定数据传输完毕后，DMA 控制器会在相应的通道设置传输完成标志 FTF，并可以触发中断通知 CPU 数据传输完成。</p>
</li>
</ul>
<blockquote>
<p>以 Hhello 为例，上述流程会执行五次，直到 CNT &#x3D;&#x3D; 0，将 FTF 位置1；</p>
</blockquote>
<h2 id="DMA-通道映射表"><a href="#DMA-通道映射表" class="headerlink" title="DMA 通道映射表"></a>DMA 通道映射表</h2><p><strong>DMA通道外设映射表</strong>，用于配置 DMA 控制器与外设之间的连接关系</p>
<p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407DMAtongdaoyinshe.png" alt="F407DMAtongdaoyinshe"></p>
<h2 id="传输控制器"><a href="#传输控制器" class="headerlink" title="传输控制器"></a>传输控制器</h2><p>DMA 和外设均可配置为传输控制器：</p>
<ul>
<li>DMA 作为传输控制器：可配置数据传输长度，最大为 65535。</li>
<li>外设作为传输控制器：数据传输的完成取决于外设的最后一个传输请求。</li>
</ul>
<blockquote>
<p>默认情况下都是 DMA 作为传输控制器，可通过 dma_flow_controller_config 函数进行修改</p>
</blockquote>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>功能：通过 DMA 实现 USART 的数据收发</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DMA 配置（内存 -&gt; 外设）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">DMA_USART0_Tx_Config</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">	<span class="comment">// 使能外设DMA1时钟</span></span><br><span class="line">	rcu_periph_clock_enable(RCU_DMA1);</span><br><span class="line">	<span class="comment">// 配置 DMA 的传输模式(多数据传输/单数据传输)</span></span><br><span class="line">	<span class="comment">// 这里选择单数据传输</span></span><br><span class="line">	dma_single_data_parameter_struct  dma_single_init;</span><br><span class="line">    <span class="comment">// 结构体初始化函数</span></span><br><span class="line">	dma_single_data_para_struct_init(&amp;dma_single_init);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 外设地址</span></span><br><span class="line">	dma_single_init.periph_addr = (<span class="type">uint32_t</span>)(&amp;USART_DATA(USART0));</span><br><span class="line">	<span class="comment">// 是否要使能外设地址偏移</span></span><br><span class="line">	dma_single_init.periph_inc = DMA_PERIPH_INCREASE_DISABLE;</span><br><span class="line">	<span class="comment">// 内存地址，发送时候才知道，暂时无法配置	</span></span><br><span class="line">	<span class="comment">// dma_single_init.memory0_addr = 0U;		</span></span><br><span class="line">	<span class="comment">// 使能内存地址偏移</span></span><br><span class="line">	dma_single_init.memory_inc = DMA_MEMORY_INCREASE_ENABLE;	</span><br><span class="line">	<span class="comment">// 数据宽度，即每次搬运的数据大小</span></span><br><span class="line">	dma_single_init.periph_memory_width = DMA_PERIPH_WIDTH_8BIT;	</span><br><span class="line">	<span class="comment">// 是否需要循环执行		</span></span><br><span class="line">	dma_single_init.circular_mode = DMA_CIRCULAR_MODE_DISABLE;	</span><br><span class="line">	<span class="comment">// 数据搬运的方向 内存 -&gt; 外设</span></span><br><span class="line">	dma_single_init.direction = DMA_MEMORY_TO_PERIPH;	</span><br><span class="line">	<span class="comment">// 数据传输的位数，即我们需要发送少多少个（periph_memory_width）大小的数据</span></span><br><span class="line">    <span class="comment">// 这也要等到发送时候才能知道</span></span><br><span class="line">	<span class="comment">// init_struct-&gt;number = 0U;</span></span><br><span class="line">	<span class="comment">// 优先级可以默认</span></span><br><span class="line">	dma_single_init.priority = DMA_PRIORITY_LOW;	</span><br><span class="line"> 	<span class="comment">// DMA 初始化配置</span></span><br><span class="line">	dma_single_data_mode_init(DMA1, DMA_CH7, &amp;dma_single_init);</span><br><span class="line">	<span class="comment">// DMA 通道功能选择</span></span><br><span class="line">	dma_channel_subperipheral_select(DMA1, DMA_CH7, DMA_SUBPERI4);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MDA 配置（外设 -&gt; 内存）</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">MDA1_USART0_Rx_Config</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 清空 DAM1 下 DMA_CH5 通道的配置</span></span><br><span class="line">	dma_deinit(DMA1, DMA_CH5);</span><br><span class="line">    <span class="comment">// 使能DMA1外设时钟</span></span><br><span class="line">	rcu_periph_clock_enable(RCU_DMA1);</span><br><span class="line">	<span class="comment">// 创建DMA配置文件</span></span><br><span class="line">	dma_single_data_parameter_struct dma_usart0_rx_init;</span><br><span class="line">	<span class="comment">// 初始化DMA配置</span></span><br><span class="line">	dma_single_data_para_struct_init(&amp;dma_usart0_rx_init);</span><br><span class="line">	<span class="comment">// 配置数据搬运的方向</span></span><br><span class="line">	dma_usart0_rx_init.direction = DMA_PERIPH_TO_MEMORY;</span><br><span class="line">    <span class="comment">// 配置外设地址</span></span><br><span class="line">	dma_usart0_rx_init.periph_addr = (<span class="type">uint32_t</span>)(&amp;USART_DATA(USART0));</span><br><span class="line">	<span class="comment">// 配置内存地址</span></span><br><span class="line">	dma_usart0_rx_init.memory0_addr = (<span class="type">uint32_t</span>)dts;</span><br><span class="line">	<span class="comment">// 配置内存地址偏移使能</span></span><br><span class="line">	dma_usart0_rx_init.memory_inc = DMA_MEMORY_INCREASE_ENABLE;</span><br><span class="line">    <span class="comment">// 关闭外设地址偏移使能</span></span><br><span class="line">	dma_usart0_rx_init.periph_inc = DMA_PERIPH_INCREASE_DISABLE;</span><br><span class="line">	<span class="comment">// 配置数据发送宽度（每一次发送的数据宽度）</span></span><br><span class="line">	dma_usart0_rx_init.periph_memory_width = DMA_PERIPH_WIDTH_8BIT;</span><br><span class="line">    <span class="comment">// 是否重复执行</span></span><br><span class="line">	dma_usart0_rx_init.circular_mode = DMA_CIRCULAR_MODE_DISABLE;</span><br><span class="line">	<span class="comment">// 配置传输的数据长度</span></span><br><span class="line">	dma_usart0_rx_init.number = <span class="number">5</span>;</span><br><span class="line">	<span class="comment">// 初始化DMA配置	</span></span><br><span class="line">	dma_single_data_mode_init(DMA1, DMA_CH5, &amp;dma_usart0_rx_init);</span><br><span class="line">	<span class="comment">// 选择DMA1通道5下的具体执行编号</span></span><br><span class="line">	dma_channel_subperipheral_select(DMA1, DMA_CH5, DMA_SUBPERI4);</span><br><span class="line">	<span class="comment">// 使能DMA1</span></span><br><span class="line">	dma_channel_enable(DMA1, DMA_CH5);	</span><br><span class="line">&#125;</span><br><span class="line">=========================================================================</span><br><span class="line"><span class="comment">// 如果使用 USART，那么在 USART 配置文件中中也要开启 DMA 使能</span></span><br><span class="line"><span class="comment">/*=================DMA配置配置=================*/</span></span><br><span class="line"><span class="comment">// 启用 USART 的 DMA 发送功能    </span></span><br><span class="line">usart_dma_transmit_config(USART0, USART_TRANSMIT_DMA_ENABLE);</span><br><span class="line"><span class="comment">// 启用 USART 的 DMA 接收功能  </span></span><br><span class="line">usart_dma_receive_config(USART0, USART_RECEIVE_DMA_ENABLE); </span><br><span class="line"></span><br><span class="line">==========================================================================</span><br><span class="line"><span class="comment">// UART0 中断处理函数</span></span><br><span class="line"><span class="type">void</span> USART0_IRQHandler(<span class="type">void</span>) &#123;	</span><br><span class="line">	<span class="keyword">if</span>(SET == usart_interrupt_flag_get(USART0, USART_INT_FLAG_IDLE)) &#123;</span><br><span class="line">		usart_data_receive(USART0);</span><br><span class="line">		<span class="comment">// LDLE 串口空中断时先关闭 DMA 使能，方便清除标志位后开启</span></span><br><span class="line">		dma_channel_disable(DMA1, DMA_CH5);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;rece_data = %c, %c, %c, %c, %c\n&quot;</span>, dts[<span class="number">0</span>], dts[<span class="number">1</span>], dts[<span class="number">2</span>], dts[<span class="number">3</span>], dts[<span class="number">4</span>]);</span><br><span class="line">		<span class="comment">// 清除 TFT 标志位(置0)，当传输完成后它会自动置 1</span></span><br><span class="line">        <span class="comment">// 所以此处并不需要进行阻塞判断</span></span><br><span class="line">		dma_flag_clear(DMA1, DMA_CH5, DMA_FLAG_FTF);</span><br><span class="line">		<span class="comment">// 重新使能 DMA 标志位</span></span><br><span class="line">		dma_channel_enable(DMA1, DMA_CH5);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">send_data</span><span class="params">(<span class="type">uint8_t</span> dat)</span> &#123;</span><br><span class="line">    <span class="comment">// 配置内存数据地址</span></span><br><span class="line">	dma_memory_address_config(DMA1, DMA_CH7, DMA_MEMORY_0, (<span class="type">uint32_t</span>)(&amp;dat));</span><br><span class="line">    <span class="comment">// 配置数据传输的位数(个数)</span></span><br><span class="line">	dma_transfer_number_config(DMA1, DMA_CH7, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 使能 DMA1</span></span><br><span class="line">	dma_channel_enable(DMA1, DMA_CH7);</span><br><span class="line">	<span class="comment">// 发送完后 FTF 会置 1</span></span><br><span class="line">    <span class="comment">// 为了保证发送完成，此处需要阻塞进行等待</span></span><br><span class="line">	<span class="keyword">while</span>(RESET == dma_flag_get(DMA1, DMA_CH7, DMA_FLAG_FTF));</span><br><span class="line">	<span class="comment">// 清除中断标志位</span></span><br><span class="line">	dma_flag_clear(DMA1, DMA_CH7, DMA_FLAG_FTF);</span><br><span class="line">&#125;</span><br><span class="line">================================================================</span><br><span class="line"><span class="comment">// 如果需要启用 DMA 中断，则需要在进行 DMA 配置时添加如下配置    </span></span><br><span class="line"><span class="comment">// 1. 使能 NIVC</span></span><br><span class="line">nvic_irq_enable(DMA1_Channel0, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">// 配置 DMA 中断源</span></span><br><span class="line"><span class="comment">// 使能 DMA 中断</span></span><br><span class="line">dma_interrupt_enable(DMA1, DMA_CH0, DMA_INT_FTF);</span><br><span class="line"><span class="comment">// 最后在使能 DMA</span></span><br><span class="line"><span class="comment">// 2. 编写 NVIC 使能时指定的中断处理函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">DMA1_Channel0_IRQHandler</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(SET == dma_interrupt_flag_get(DMA1, DMA_CH0, DMA_INT_FLAG_FTF)) &#123;</span><br><span class="line">        <span class="comment">// 清除标志位，我们需要查看寄存器的标志位说明了解是否需要手动清除</span></span><br><span class="line">        dma_interrupt_flag_clear(DMA1, DMA_CH0, DMA_INT_FLAG_FTF);</span><br><span class="line">        <span class="comment">// 业务逻辑</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(dst) / <span class="keyword">sizeof</span>(dst[<span class="number">0</span>]); i++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, (<span class="type">int</span>)dst[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>配置 DMA，在相关外设中启用 DMA 的发送过能，（如果需要可开启中断）；</p>
</li>
<li><p>在使用中断时候我们通常需要进行标志位判断，这时候我们就需要知道当中断触发时候标志位是 0 还是 1，我们就需要去查看用户手册中当前章节的终端说明或者寄存器中该标志位的说明；</p>
</li>
<li><p>FTF 标志位在复位时自动置 0，当传输完成后自动置 1，需要我们手动置 0；</p>
</li>
</ul>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p><strong>重复执行</strong></p>
<p>当 DMA 完成一轮数据传输后，会自动将目标地址重置回初始地址，并继续进行下一轮的传输。</p>
<p><strong>usart_dma_transmit_config(USART0, USART_TRANSMIT_DMA_ENABLE);</strong></p>
<p>这条语句用于启用 USART0 的 DMA 发送功能。它将配置 USART0，使得数据的发送不再通过 CPU 逐个字节传输，而是通过 DMA 控制器来直接将数据从内存传输到 USART 数据寄存器，从而提高数据传输效率，减少 CPU 的负担。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>一、<strong>DMA 的配置文件重复执行两次后为什么 FTF 标志位的值会从 0 变成 1</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dma_deinit(DMA1, DMA_CH5);</span><br><span class="line">dma_flag_clear(DMA1, DMA_CH7, DMA_FLAG_FTF);</span><br></pre></td></tr></table></figure>

<p>上面两行代码可以解决这个问题：</p>
<p>当你 <strong>第一次配置并启动 DMA</strong>，但并没有实际进行数据搬运操作时，FTF（全传输完成标志）会保持为 0，因为没有触发实际的传输操作。但是，当你 <strong>第二次重新配置 DMA</strong> 并执行初始化时，此时不管你有没有使能 DMA；DMA 控制器都会认为之前的传输已经完成，因此它会 <strong>错误地将 <code>FTF</code> 置为 1</strong>。</p>
<p>二、<strong>为什么外设 -&gt; 内存需要清除 FTF 标志位，而内存 -&gt; 内存、内存 -&gt; 外设就不需要呢</strong></p>
<p>问题的关键在于 DMA 配置的时机和操作的顺序，</p>
<p>其实内存 -&gt; 内存、内存 -&gt; 外设也存在这个问题，区别在于，内存 -&gt; 内存、内存 -&gt; 外设二者的发送源要到具体的发送时候才可以确定，也就说我们要到那个时候才会去配置发送源和开启 DMA 使能，那么前面执行的两次初始化配置对于 DMA 来说和 1 次没区别。</p>
<p>三、<strong>当我们通过 USART 向内存写入的数据，超过我们在 PWM 中所定义的个数时，第二次打印的头一个字节会是 PWM 中定义的个数的下一个字节，为什么</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">假设，我们定义传输长度为 <span class="number">5</span></span><br><span class="line"></span><br><span class="line">我们第一次传输 hello1，它会显示 hello</span><br><span class="line"></span><br><span class="line">我们第二次传输hello,	它会显示<span class="number">1</span>hell</span><br><span class="line"></span><br><span class="line">为什么？</span><br></pre></td></tr></table></figure>

<p>因为当你外设传递的数据位数，超过你 DMA 配置数据长度时，他会将 DMA 配置数据长度 + 1 位数的字节存在他的缓冲区里面，其他全部丢弃，造成后面的数据就都会错位一个字节；</p>
<p>解决：尽可能定义大的空间把所有数据都接到；</p>
<p>三、<strong>当我们要使用 DMA 功能时候没有头绪要怎么做</strong></p>
<p>通过用户手册<strong>查看 DMA 关系映射表</strong>：在使用 DMA 时，首先要找到 DMA 与我们要搬运的外设之间的对应关系；</p>
<p>通过用户手册查看 DMA 的关系映射表，找到外设所映射的通道在那个 DMA 中，进行配置即可；</p>
<p>例如，我们要使用 ADC0 时，找到 ADC0 对应的是 DMA1 中通道0的第一个通道 000，那么我们只需要配置 DMA1 并指定通道1，子通道为 000 即可；</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">博主</a></li>
        
          <li><a href="/tags/">标签</a></li>
        
          <li><a href="/categories/">分类</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#DMA-%E4%BC%A0%E8%BE%93%E6%96%B9%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">DMA 传输方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DMA-%E4%B8%89%E7%A7%8D%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%BC%8F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="toc-number">1.1.</span> <span class="toc-text">DMA 三种传输模式的数据流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%AE%BE%E6%8F%A1%E6%89%8B"><span class="toc-number">1.2.</span> <span class="toc-text">外设握手</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">传输模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DMA-%E5%8F%82%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">DMA 参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DMA-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">DMA 执行流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DMA-%E9%80%9A%E9%81%93%E6%98%A0%E5%B0%84%E8%A1%A8"><span class="toc-number">5.</span> <span class="toc-text">DMA 通道映射表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">传输控制器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.</span> <span class="toc-text">实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">7.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E"><span class="toc-number">7.2.</span> <span class="toc-text">说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">8.</span> <span class="toc-text">问题</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&text=DMA"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&title=DMA"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&is_video=false&description=DMA"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=DMA&body=Check out this article: https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&title=DMA"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&title=DMA"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&title=DMA"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&title=DMA"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&name=DMA&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/DMA/&t=DMA"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2025
    kay
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">博主</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
