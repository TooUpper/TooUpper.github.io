<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="在嵌入式开发中，ADC（Analog-to-Digital Converter，模拟-数字转换器）是一种将模拟信号转换为数字信号的硬件组件。它的主要功能是将输入的模拟信号（如温度、压力、电压等）转换为相应的数字信号，使微控制器（MCU）或处理器能够读取和处理这些信息。 ADC采样的频率越高，得到的数字信号就越接近原来的模拟信号，也就是保真度越高，但是需要更多的资源和计算功耗。  分类逐次逼近型 A">
<meta property="og:type" content="article">
<meta property="og:title" content="ADC">
<meta property="og:url" content="https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/index.html">
<meta property="og:site_name" content="流年不知心底事">
<meta property="og:description" content="在嵌入式开发中，ADC（Analog-to-Digital Converter，模拟-数字转换器）是一种将模拟信号转换为数字信号的硬件组件。它的主要功能是将输入的模拟信号（如温度、压力、电压等）转换为相应的数字信号，使微控制器（MCU）或处理器能够读取和处理这些信息。 ADC采样的频率越高，得到的数字信号就越接近原来的模拟信号，也就是保真度越高，但是需要更多的资源和计算功耗。  分类逐次逼近型 A">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCguocheng.png">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCcaiyang.png">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADClianghua.png">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/STC8H/ADCzhuanhuanliuchengtu.png">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCtongbumoshi.png">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/STM32/STM32F407/F407ADCcxukuangtu.png">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCshujutexingbiao.png">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCwenduchuanganqitexbiao.png">
<meta property="og:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCwendujisuan.png">
<meta property="article:published_time" content="2024-11-10T03:15:00.000Z">
<meta property="article:modified_time" content="2025-01-07T10:58:33.648Z">
<meta property="article:author" content="kay">
<meta property="article:tag" content="GD32F407">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.tooupper.org/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCguocheng.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>ADC</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">博主</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/%E7%9C%8B%E9%97%A8%E7%8B%97/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/I2C/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&text=ADC"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&title=ADC"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&is_video=false&description=ADC"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ADC&body=Check out this article: https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&title=ADC"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&title=ADC"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&title=ADC"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&title=ADC"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&name=ADC&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&t=ADC"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">1.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%90%E6%AC%A1%E9%80%BC%E8%BF%91%E5%9E%8B%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">逐次逼近型工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">运行模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.</span> <span class="toc-text">同步模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E9%80%9A%E9%81%93%E5%92%8C%E6%B3%A8%E5%85%A5%E9%80%9A%E9%81%93"><span class="toc-number">5.</span> <span class="toc-text">常规通道和注入通道</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AF%B9%E9%BD%90"><span class="toc-number">6.</span> <span class="toc-text">数据对齐</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E6%A1%86%E5%9B%BE"><span class="toc-number">7.</span> <span class="toc-text">模块框图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%80%A7%E8%A1%A8"><span class="toc-number">8.</span> <span class="toc-text">特性表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%A9%E5%BA%A6%E8%AE%A1%E7%AE%97"><span class="toc-number">9.</span> <span class="toc-text">温度计算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.</span> <span class="toc-text">实现</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        ADC
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">kay</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-11-10T03:15:00.000Z" class="dt-published" itemprop="datePublished">2024-11-10</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/ARM/">ARM</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/GD32F407/" rel="tag">GD32F407</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>在嵌入式开发中，<strong>ADC</strong>（Analog-to-Digital Converter，模拟-数字转换器）是一种将模拟信号转换为数字信号的硬件组件。它的主要功能是将输入的模拟信号（如温度、压力、电压等）转换为相应的数字信号，使微控制器（MCU）或处理器能够读取和处理这些信息。</p>
<p>ADC采样的频率越高，得到的数字信号就越接近原来的模拟信号，也就是保真度越高，但是需要更多的资源和计算功耗。</p>
<p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCguocheng.png" alt="F407ADCguocheng"></p>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><p><strong>逐次逼近型 ADC (SAR-ADC)</strong></p>
<ul>
<li><strong>工作原理</strong>：逐步逼近输入信号的电压值，每次比较输入信号与参考电压，逐步调整数字输出直到找到最接近的值。</li>
<li><strong>特点</strong>：中等速度、高精度、低功耗，适用于常规数据采集。</li>
</ul>
<p><strong>Flash ADC</strong></p>
<ul>
<li><strong>工作原理</strong>：使用多个并行的比较器同时比较输入信号与不同的参考电压级别，直接输出数字结果。</li>
<li><strong>特点</strong>：极高速、低分辨率、硬件复杂，适用于实时信号处理。</li>
</ul>
<p><strong>Sigma-Delta ADC</strong></p>
<ul>
<li><strong>工作原理</strong>：通过过采样将模拟信号转换为数字信号，使用噪声整形将高频噪声移至高频区，然后通过数字滤波器还原数字信号。</li>
<li><strong>特点</strong>：高分辨率、精度高、速度较慢，适用于高精度测量。</li>
</ul>
<p><strong>Pipeline ADC</strong></p>
<ul>
<li><strong>工作原理</strong>：将转换过程分为多个阶段，每个阶段逐步完成一部分转换，最终合并结果输出。</li>
<li><strong>特点</strong>：高速、适中分辨率，适用于视频、通信等高速应用。</li>
</ul>
<p><strong>Dual-Slope ADC</strong></p>
<ul>
<li><strong>工作原理</strong>：首先对输入信号进行积分，然后用已知参考电压再次积分，通过比较两个积分时间来确定输入信号的数字值。</li>
<li><strong>特点</strong>：高精度、速度较慢、抗噪声能力强，适用于精密测量。</li>
</ul>
<p><strong>并行型 ADC</strong></p>
<ul>
<li><strong>工作原理</strong>：通过多个并行的比较器同时对输入信号进行比较，快速得出数字结果。</li>
<li><strong>特点</strong>：极高速、低分辨率，硬件需求高，适合高速数据采集。</li>
</ul>
<p><strong>差分型 ADC</strong></p>
<ul>
<li><strong>工作原理</strong>：测量两个输入端点之间的电压差，消除共模噪声，提高精度。</li>
<li><strong>特点</strong>：抗共模噪声能力强，适用于差分信号的测量。</li>
</ul>
<p><strong>异步 ADC</strong></p>
<ul>
<li><strong>工作原理</strong>：不依赖固定时钟，根据输入信号的变化动态调整采样频率。</li>
<li><strong>特点</strong>：灵活，适用于时钟不稳定或需要动态调整采样频率的特殊场合。</li>
</ul>
<p><strong>温控型 ADC</strong></p>
<ul>
<li><strong>工作原理</strong>：通过比较器对输入信号进行测量，采用热计数器方法，最终通过计数来确定数字值。</li>
<li><strong>特点</strong>：高精度，适用于精密仪器和特殊测量系统。</li>
</ul>
<h2 id="逐次逼近型工作原理"><a href="#逐次逼近型工作原理" class="headerlink" title="逐次逼近型工作原理"></a>逐次逼近型工作原理</h2><p>逐次逼近型 ADC 的工作原理是将模拟信号通过<strong>采样</strong>转换为离散的数字信号，然后再通过<strong>量化</strong>、<strong>编码</strong>等处理，最终得到对应的数字表示。</p>
<p><strong>采样</strong></p>
<p>采样（Sampling）是将连续的模拟信号转化为离散的数字信号的过程；ADC 通过以固定周期的脉冲采集模拟型号，这样就可以得到一个在时间上离散的信号。</p>
<p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCcaiyang.png" alt="F407ADCcaiyang"></p>
<p><strong>量化</strong></p>
<p>虽然采样可以把连续信号变成一系列离散的值，但这些离散的值本身可能是无限精细的（理论上是连续的），计算机无法直接处理这样的无限精度。量化的目的是将这些信号值映射到有限数量的离散数字上，确保信号可以被计算机和数字设备正确处理。</p>
<p>量化是把<strong>采样得到的连续信号值</strong>转换成<strong>离散的数字值</strong>的过程。它将信号值映射到<strong>一定数量的离散级</strong>别上，这些离散的数字值是计算机能理解和处理的。</p>
<p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADClianghua.png" alt="F407ADClianghua"></p>
<p><strong>分辨率：</strong>是指数字信号可以表示的<strong>离散级别</strong>的数量，通常由<strong>位数（bit）</strong>来表示。</p>
<p>例如，8位（8-bit）的分辨率表示量化系统能够表示 2<sup>8</sup> &#x3D; 256 个不同的离散等级，16位（16-bit）则能表示 2<sup>16</sup> &#x3D;  65536 个不同的等级。</p>
<p><strong>编码</strong></p>
<p>将量化后的数字值转化为标准的数字格式的过程，用 0 和 1 组合为每个量化区间编号,代替原来的电压值。</p>
<p><strong>ADC 转换流程图</strong></p>
<p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/STC8H/ADCzhuanhuanliuchengtu.png" alt="ADCzhuanhuanliuchengtu"></p>
<h2 id="运行模式"><a href="#运行模式" class="headerlink" title="运行模式"></a>运行模式</h2><p>在 ARM32 的 ADC 模块中，针对单个通道或多个通道的转换，有几种不同的 <strong>运行模式</strong> 来控制采样和转换的行为：</p>
<p><strong>单次运行模式（Single Conversion Mode）</strong></p>
<ul>
<li><p><strong>工作原理</strong>：在单次运行模式下，ADC 每次启动转换时只转换一个通道的数据。每次转换完成后，ADC 停止工作，直到下一次触发才能进行新的转换。</p>
</li>
<li><p><strong>触发方式</strong>：可以通过外部触发信号（例如定时器中断）或软件触发启动。</p>
</li>
</ul>
<p><strong>连续运行模式（Continuous Conversion Mode）</strong></p>
<ul>
<li><p><strong>工作原理</strong>：在连续运行模式下，ADC 一旦启动，就会不断地进行转换，转换完成后立刻开始下一次转换，直到停止为止。转换通道可以是单个通道，也可以是多个通道（如果使用扫描模式）。 </p>
</li>
<li><p><strong>触发方式</strong>：通常通过软件或外部触发启动，启动后 ADC 将连续进行转换。</p>
</li>
</ul>
<p><strong>扫描运行模式（Scan Mode）</strong></p>
<ul>
<li><strong>工作原理：</strong>在扫描模式下，ADC 会按照用户预先设置的顺序，自动依次对多个输入通道进行采样和转换。这些通道可以是同一组或不同组的模拟输入。扫描模式通常与 <strong>连续转换模式</strong> 或 <strong>间断转换模式</strong> 配合使用，这样可以在不干扰其他通道转换的情况下，完成多个通道的采样。</li>
</ul>
<p><strong>间断运行模式（Discontinuous Mode）</strong></p>
<ul>
<li><strong>工作原理</strong>：在间断运行模式下，ADC 会在多个通道的转换之间插入空闲时间，形成一个“间断”采样的过程。与连续模式不同，间断模式在转换时会分批次处理多个通道，每批次完成几个通道的采样，再进行下一批次的转换。</li>
<li><strong>触发方式</strong>：通常用于扫描模式下，选择如何将多个通道分批次进行转换。</li>
</ul>
<h2 id="同步模式"><a href="#同步模式" class="headerlink" title="同步模式"></a>同步模式</h2><p>当需要有多个 ADC 模块工作时，可以使用 ADC 同步模式。在 ADC 同步模式下，根据 ADC_SYNCCTL 寄存器中 SYNCM[4:0]位所选的模式，转换的启动可以是 ADC0&#x2F;ADC1&#x2F;ADC2 的交替触发或同步触发。</p>
<p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCtongbumoshi.png" alt="F407ADCtongbumoshi"></p>
<blockquote>
<p>当 ADC 工作在同步模式，而非独立模式时，如果需要再将 ADC 配置成其他同步模式，则需要<strong>在配置成其他同步模式前，首先将 ADC 配置成独立模式。</strong></p>
</blockquote>
<h2 id="常规通道和注入通道"><a href="#常规通道和注入通道" class="headerlink" title="常规通道和注入通道"></a>常规通道和注入通道</h2><p><strong>常规通道</strong></p>
<p>常规通道是 ADC 的标准通道，主要用于常规的采样和转换。它们通常是逐一进行采样的，即采样一个通道，转换完成后，再切换到下一个通道。</p>
<p><strong>注入通道</strong></p>
<p>注入通道是一种更为复杂和灵活的 ADC 通道，它允许在常规转换过程中进行优先级较高的快速采样。插入通道具有更高的优先级，可以在常规转换进行的同时，进行插入通道的转换。</p>
<p>每个注入通道（如 ADC_INJ1, ADC_INJ2, ADC_INJ3, ADC_INJ4）通常有独立的数据寄存器，可以存储不同通道的转换结果。</p>
<p>每个注入通道都对应有一个数据寄存器所以当我们需要同时采集不超过四个，且也不想用 DMA 时我们就可以采用注入通道；当转换完成后我们通过 EOIC 标志位去获取对应通道中的数据；只会在最后一个转换完成后产生一次标志位；</p>
<h2 id="数据对齐"><a href="#数据对齐" class="headerlink" title="数据对齐"></a>数据对齐</h2><p> ARM32 的 ADC 数据宽度通常为 12 位（例如 STM32F4 系列），但每个 ADC 数据寄存器通常是 16 位宽。因此，12 位的转换结果会存储在 16 位的寄存器中；所以我们这里需要指定数据的对齐方式。</p>
<p>两种对齐方式：</p>
<p><strong>左对齐 （Left Align）</strong>：</p>
<ul>
<li>在左对齐模式下，12 位的 ADC 结果会被存储在 16 位的数据寄存器的高 12 位，而低 4 位会被填充为 0。</li>
<li>例如，如果 ADC 转换的结果是 <code>0x0ABC</code>（12 位的值），那么存储到寄存器中的数据为 <code>0xABC0</code>。</li>
</ul>
<p><strong>右对齐（Right Align）</strong>：</p>
<ul>
<li>在右对齐模式下，12 位的 ADC 结果会存储在 16 位数据寄存器的低 12 位，而高 4 位会被填充为 0。</li>
<li>例如，如果 ADC 转换的结果是 <code>0x0ABC</code>（12 位的值），那么存储到寄存器中的数据为 <code>0x0ABC</code>。</li>
</ul>
<h2 id="模块框图"><a href="#模块框图" class="headerlink" title="模块框图"></a>模块框图</h2><p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/STM32/STM32F407/F407ADCcxukuangtu.png" alt="F407yihuofeimen"></p>
<blockquote>
<p>当采样任务少于 4 个时，可以使用注入组，因为注入组的每个通道都有一个独立的寄存器，可以同时进行四个采集任务</p>
</blockquote>
<p><strong>输入端口</strong></p>
<ul>
<li><p>**V_REF+ &#x2F; V_REF-**：基准电压输入端，用于确定 ADC 的量程范围。转换的数字结果在 <code>V_REF-</code> 对应 0，<code>V_REF+</code> 对应最大值（如 4095 在 12 位 ADC）。</p>
</li>
<li><p><strong>V_DDA &#x2F; V_SSA</strong>：供电引脚，用于提供 ADC 模块的工作电源。</p>
</li>
<li><p><strong>ADCx_IN0 到 ADCx_IN15</strong>：这些是模拟输入通道。可以连接到外部模拟信号，通过多路复用器（Analog Mux）选择要转换的通道。</p>
</li>
</ul>
<p><strong>多路复用器（Analog Mux）</strong></p>
<ul>
<li><p>多路复用器负责在多个输入通道中选择一个进行转换。此 ADC 模块最多可以支持 16 个通道的输入信号，允许在不同的通道之间切换。</p>
</li>
<li><p><strong>GPIO 端口</strong>：ADC 输入通道可以通过 GPIO 配置连接到传感器等外部设备，获得输入的模拟信号。</p>
</li>
<li><p>还有内置温度传感器、内部参考电压（V_REFINT）和电池电压监测端（V_BAT）。</p>
</li>
</ul>
<p><strong>通道分组</strong></p>
<p><strong>Injected Channels（注入通道）</strong>：最多可以配置 4 个注入通道。这些通道用于优先级较高的采样任务，一般在特定触发事件时被触发。</p>
<p><strong>Regular Channels（常规通道）</strong>：最多可以配置 16 个常规通道，用于定期进行采样，转换完成后的数据存储在常规数据寄存器中。</p>
<p><strong>触发控制</strong></p>
<ul>
<li><p><strong>注入通道触发控制</strong>：图中的 JEXTSEL 和 JEXTEN 控制注入通道的触发源，可以选择来自不同定时器（TIMx）的触发信号。</p>
</li>
<li><p><strong>常规通道触发控制</strong>：EXTSEL 和 EXTEN 控制常规通道的触发源，也可选择来自不同定时器（TIMx）的触发信号。</p>
</li>
<li><p>可以选择的触发源包括多种定时器的输出事件（如 TIM1_CH4, TIM2_TRGO 等），在外部事件发生时启动 ADC 转换。</p>
</li>
</ul>
<p><strong>ADC 模块</strong></p>
<ul>
<li>核心的 ADC 模块负责将模拟信号转换为数字信号。该模块可以通过 ADCCLK 时钟驱动，提供一定的采样速率。</li>
<li>ADC 数据寄存器<ul>
<li><strong>Regular Data Register</strong>：用于存储常规通道的转换结果。</li>
<li><strong>Injected Data Registers</strong>：用于存储注入通道的转换结果，每个注入通道有一个独立的数据寄存器。</li>
</ul>
</li>
</ul>
<p><strong>模拟看门狗（Analog Watchdog）</strong></p>
<ul>
<li>模拟看门狗是一种用于监控输入信号的硬件功能。它可以设定一个上限和下限（12 位精度），当 ADC 输入信号超出设定的阈值范围时，会触发报警或中断。</li>
<li>主要用于安全监控或报警用途，例如检测温度、电压或电流是否超出安全范围。</li>
</ul>
<p><strong>标志和中断控制</strong></p>
<ul>
<li><p>Flags（标志位）</p>
<p>：用于指示 ADC 的状态。常见的标志位包括：</p>
<ul>
<li><strong>OVR（Overrun）</strong>：DMA 数据覆盖错误标志。</li>
<li><strong>EOC（End of Conversion）</strong>：常规通道转换完成标志。</li>
<li><strong>JEOC（Injected End of Conversion）</strong>：注入通道转换完成标志。</li>
<li><strong>AWD（Analog Watchdog）</strong>：模拟看门狗事件标志。</li>
</ul>
</li>
<li><p><strong>中断使能位</strong>：用于控制是否允许 ADC 模块生成中断。包括 OVRIE（覆盖中断）、EOCIE（转换完成中断）、JEOCIE（注入完成中断）、AWDIE（看门狗中断）等。</p>
</li>
<li><p><strong>NVIC 中断</strong>：ADC 可将中断信号发送至 NVIC（嵌套向量中断控制器）进行处理。</p>
</li>
</ul>
<p><strong>DMA 支持</strong></p>
<ul>
<li>ADC 转换完成后可以通过 DMA（直接存储器访问）自动将数据转移到内存，而不需要 CPU 参与。</li>
<li><strong>DMA request</strong>：当常规通道完成转换后可以触发 DMA 请求，将数据自动传输到指定的存储区域。</li>
</ul>
<h2 id="特性表"><a href="#特性表" class="headerlink" title="特性表"></a>特性表</h2><p>在数据手册中：</p>
<p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCshujutexingbiao.png" alt="F407ADCshujutexingbiao"></p>
<p><strong>温度传感器特性表</strong></p>
<p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCwenduchuanganqitexbiao.png" alt="F407ADCwenduchuanganqitexbiao"></p>
<h2 id="温度计算"><a href="#温度计算" class="headerlink" title="温度计算"></a>温度计算</h2><p><strong>温度传感器计算公式如下：</strong></p>
<p><img src="/public/image/%E5%B5%8C%E5%85%A5%E5%BC%8F/MCU/ARM/Cortex-M4/GD32/GD32F407/F407ADCwendujisuan.png" alt="F407ADCwendujisuan"></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>功能：通过 ADC 采集芯片内部的问题</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;gd32f4xx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;systick.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;BSP_USART.h&quot;</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	通过 ADC 采集芯片内部温度</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// ADC 配置	</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">adc_config</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">	<span class="comment">// </span></span><br><span class="line">	adc_deinit();</span><br><span class="line">	rcu_periph_clock_enable(RCU_ADC0);	</span><br><span class="line">	<span class="comment">// 分频</span></span><br><span class="line">	<span class="comment">// 查看时钟树发现 ADC 组大支持 40MHz</span></span><br><span class="line">	<span class="comment">// 而 ADC 的两个时钟来源均超过 40 所以我们要先进行选择和分频</span></span><br><span class="line">	<span class="comment">// 选择时钟来源和分频 选择APB2，4分频</span></span><br><span class="line">	adc_clock_config(ADC_ADCCK_PCLK2_DIV4);</span><br><span class="line">	<span class="comment">// 因为我们就一个 ADC 工作所以这里要选择独立模式</span></span><br><span class="line">	<span class="comment">// 独立模式是相对于同步模式来说的，所以在同步中设置</span></span><br><span class="line">	adc_sync_mode_config(ADC_SYNC_MODE_INDEPENDENT);</span><br><span class="line">	<span class="comment">// 设置工作模式，单次还是多次，扫描还是不扫描</span></span><br><span class="line">	<span class="comment">// 只有 ADC0 支持内部通道，芯片温度属于内部通道</span></span><br><span class="line">	adc_special_function_config(ADC0, ADC_SCAN_MODE,  DISABLE);<span class="comment">// 失能扫描</span></span><br><span class="line">	adc_special_function_config(ADC0, ADC_CONTINUOUS_MODE, DISABLE); <span class="comment">// 非连续 </span></span><br><span class="line">	<span class="comment">// 是否打开插入通道(自动转换)，我们使用常规通道所以不打开</span></span><br><span class="line">	adc_special_function_config(ADC0, ADC_INSERTED_CHANNEL_AUTO, DISABLE);</span><br><span class="line">	<span class="comment">// 设置分辨率</span></span><br><span class="line">	adc_resolution_config(ADC0, ADC_RESOLUTION_12B);</span><br><span class="line">	<span class="comment">// 设置对齐方向</span></span><br><span class="line">	adc_data_alignment_config(ADC0, ADC_DATAALIGN_RIGHT);</span><br><span class="line">	<span class="comment">// 设置转换通道的个数（包括常规通道和插入通道）</span></span><br><span class="line">	<span class="comment">// 我们这里只用到一个常规通道，所以就打开一个，如果是注入通道就选择注入同到</span></span><br><span class="line">	adc_channel_length_config(ADC0, ADC_ROUTINE_CHANNEL, <span class="number">1</span>);</span><br><span class="line">	<span class="comment">// 将通道和引脚对应起来，或者说绑定起来</span></span><br><span class="line">    <span class="comment">// 注入通道方法为 adc_INSERTED_channel_config</span></span><br><span class="line">	<span class="comment">// 参数一、指定要配置的 ADC 外设</span></span><br><span class="line">	<span class="comment">// 参数二、要使用的通道编号，也就是在 ADC 的那个通道中进行转换</span></span><br><span class="line">	<span class="comment">// 参数三、通道编号，具体的哪个物理输入通道进行采样。</span></span><br><span class="line">	<span class="comment">// 参数四、设置 ADC 采样的时常</span></span><br><span class="line">    <span class="comment">// 如果想要对外部引脚的外设进行采样,</span></span><br><span class="line">	adc_routine_channel_config(ADC0, <span class="number">0</span>, ADC_CHANNEL_16, ADC_SAMPLETIME_480);</span><br><span class="line">	<span class="comment">// 在对内部引脚进行采样时，需要特别设置一下的参数</span></span><br><span class="line">	adc_channel_16_to_18(ADC_TEMP_VREF_CHANNEL_SWITCH, ENABLE);</span><br><span class="line">	<span class="comment">// 使能 ADC</span></span><br><span class="line">	adc_enable(ADC0);	</span><br><span class="line">	<span class="comment">// ADC 使能后需等待 1 时间后才能采样，</span></span><br><span class="line">	delay_1us(<span class="number">1</span>);</span><br><span class="line">	<span class="comment">// 延迟14个CK_ADC以等待ADC稳定；	</span></span><br><span class="line">	adc_calibration_enable(ADC0);	 </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取温度</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_mcu_temperature</span><span class="params">(<span class="type">void</span>)</span> &#123;	</span><br><span class="line">	<span class="comment">// 触发采集</span></span><br><span class="line">	<span class="comment">// 我们这里通过软件进行触发</span></span><br><span class="line">	adc_software_trigger_enable(ADC0, ADC_ROUTINE_CHANNEL);</span><br><span class="line">	<span class="comment">// 等待 EOC 标志位置为，也就是等待采集成功</span></span><br><span class="line">	<span class="keyword">while</span>(RESET == adc_flag_get(ADC0, ADC_FLAG_EOC));</span><br><span class="line">	<span class="comment">// 常规序列转换结束时硬件置位，软件写 0 或读 ADC_RDATA 寄存器清除。</span></span><br><span class="line">	<span class="type">uint16_t</span> mcu_temperature_code = adc_routine_data_read(ADC0);</span><br><span class="line">   	<span class="comment">// 这里最好不要重复清除，当多任务时候，上面清楚后另一个任务可能就会立即写入</span></span><br><span class="line">	<span class="comment">// 这里如果后面在清除，可能会影响后续转换的值</span></span><br><span class="line">	<span class="comment">//adc_flag_clear(ADC0, ADC_FLAG_EOC);</span></span><br><span class="line">	<span class="comment">// 将对应的编码值转换为温度</span></span><br><span class="line">    <span class="comment">// 查看手册可以得到温度的转换公式：</span></span><br><span class="line">    <span class="comment">// 25V 下的电压为 1.45</span></span><br><span class="line">    <span class="comment">// 当前的电压值：(mcu_temperature_code / 4096 * 3.3) = 1.45</span></span><br><span class="line">    <span class="comment">// 4.1mV 要记得改为 V ==&gt; 4.1 1 1000</span></span><br><span class="line">    <span class="comment">// ((1.45 - 当前的电压值) /  (4.1 / 1000)) + 25</span></span><br><span class="line">	<span class="type">float</span> mcu_temperature = (<span class="number">1.45</span> - (<span class="number">3.3</span> * mcu_temperature_code / <span class="number">4096</span>)) / (<span class="number">4.1</span> / <span class="number">1000</span>) + <span class="number">25</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;mcu_temperature = %f\n&quot;</span>, mcu_temperature);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    systick_config();</span><br><span class="line">    usart0_init();</span><br><span class="line">	adc_config();</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;App_start...&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		delay_1ms(<span class="number">1000</span>);</span><br><span class="line">		get_mcu_temperature();		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;   </span><br><span class="line">============================================================================</span><br><span class="line"><span class="comment">// 在常规通道组中，多个通道通信采样时候只有最后一个会触发 EOC 标志位</span></span><br><span class="line"><span class="comment">// 所以当我们需要通过进行多个通道采样的时候，就需要放一次采样一次，以此来得到真确的结果；</span></span><br><span class="line"><span class="comment">// 该方法同时只能有一个通道进行工作，效率比较低    </span></span><br><span class="line"><span class="comment">// 添加电位器引脚的GPIO配置</span></span><br><span class="line">rcu_periph_clock_enable(RCU_GPIOC);</span><br><span class="line">gpio_mode_set(GPIOC, GPIO_MODE_ANALOG, GPIO_PUPD_NONE, GPIO_PIN_4);    </span><br><span class="line">    </span><br><span class="line"><span class="comment">// 读取温度和电位器</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_mcu_temperature</span><span class="params">(<span class="type">void</span>)</span> &#123;	</span><br><span class="line">	<span class="comment">// 先将内部温度对应的物理通道放入通道进行采样</span></span><br><span class="line">    adc_routine_channel_config(ADC0, <span class="number">0</span>, ADC_CHANNEL_16, ADC_SAMPLETIME_480);    </span><br><span class="line">	adc_software_trigger_enable(ADC0, ADC_ROUTINE_CHANNEL);</span><br><span class="line">	<span class="keyword">while</span>(RESET == adc_flag_get(ADC0, ADC_FLAG_EOC));</span><br><span class="line">	<span class="type">uint16_t</span> mcu_temperature_code = adc_routine_data_read(ADC0);</span><br><span class="line">	<span class="type">float</span> mcu_temperature = (<span class="number">1.45</span> - (<span class="number">3.3</span> * mcu_temperature_code / <span class="number">4096</span>)) / (<span class="number">4.1</span> / <span class="number">1000</span>) + <span class="number">25</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;mcu_temperature = %f\n&quot;</span>, mcu_temperature);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 再将电位器对应的物理通道放入通道进行采样</span></span><br><span class="line">    adc_routine_channel_config(ADC0, <span class="number">0</span>, ADC_CHANNEL_14, ADC_SAMPLETIME_480);    </span><br><span class="line">	adc_software_trigger_enable(ADC0, ADC_ROUTINE_CHANNEL);</span><br><span class="line">	<span class="keyword">while</span>(RESET == adc_flag_get(ADC0, ADC_FLAG_EOC));</span><br><span class="line">	<span class="type">uint16_t</span> mcu_temperature_code = adc_routine_data_read(ADC0);</span><br><span class="line">	<span class="type">float</span> mcu_dianweiqi = (<span class="number">3.3</span> * mcu_temperature_code / <span class="number">4096</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;mcu_dianweiqi = %f\n&quot;</span>, mcu_dianweiqi);	</span><br><span class="line">&#125;   </span><br><span class="line">==================================================================================</span><br><span class="line"><span class="comment">// 使用 DMA 实现多个通道的数据采集</span></span><br><span class="line"><span class="comment">// 当同时有多个通道时，只有最后一个通道会返回 EOC 标志位，所以我们可以使用 DMA 让每次采集完就把数据搬运出来</span></span><br><span class="line"><span class="comment">// 而不是等所有通道都采集完之后 EOC 置位才进行采集；    </span></span><br><span class="line"><span class="comment">/*************** ADC 中的 DMA配置 *********************/</span></span><br><span class="line"><span class="comment">// 当 DMA 使能后，每次转换完成后都启用 DMA 传输</span></span><br><span class="line">adc_dma_request_after_last_enable(ADC0);</span><br><span class="line"><span class="comment">// DMA 使能</span></span><br><span class="line">adc_dma_mode_enable(ADC0);</span><br><span class="line"><span class="comment">// 要放在 ADC 使能之前</span></span><br><span class="line"><span class="comment">// 触发采集，软件触发</span></span><br><span class="line">adc_software_trigger_enable(ADC0, ADC_ROUTINE_CHANNEL);</span><br><span class="line"><span class="comment">// DMA 初始化</span></span><br><span class="line"><span class="comment">// DMA 配置</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">adc_dma_config</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">	<span class="comment">// 重置下 DMA</span></span><br><span class="line">	dma_deinit(DMA1, DMA_CH0);	</span><br><span class="line">	<span class="comment">// 使能外设DMA1时钟</span></span><br><span class="line">	rcu_periph_clock_enable(RCU_DMA1);</span><br><span class="line">	<span class="comment">// 配置 DMA 的传输模式(多数据传输/单数据传输)</span></span><br><span class="line">	<span class="comment">// 这里选择单数据传输</span></span><br><span class="line">	dma_single_data_parameter_struct  dma_single_init;</span><br><span class="line">    <span class="comment">// 结构体初始化函数</span></span><br><span class="line">	dma_single_data_para_struct_init(&amp;dma_single_init);</span><br><span class="line">	<span class="comment">// 外设地址</span></span><br><span class="line">	dma_single_init.periph_addr = (<span class="type">uint32_t</span>)(&amp;ADC_RDATA(ADC0));</span><br><span class="line">	<span class="comment">// 是否要使能外设地址偏移</span></span><br><span class="line">	dma_single_init.periph_inc = DMA_PERIPH_INCREASE_DISABLE;</span><br><span class="line">	<span class="comment">// 内存地址，发送时候才知道，暂时无法配置	</span></span><br><span class="line">	dma_single_init.memory0_addr = (<span class="type">uint32_t</span>)dta;		</span><br><span class="line">	<span class="comment">// 使能内存地址偏移</span></span><br><span class="line">	dma_single_init.memory_inc = DMA_MEMORY_INCREASE_ENABLE;	</span><br><span class="line">	<span class="comment">// 数据宽度，即每次搬运的数据大小</span></span><br><span class="line">	dma_single_init.periph_memory_width = DMA_PERIPH_WIDTH_16BIT;	</span><br><span class="line">	<span class="comment">// 是否需要循环执行		</span></span><br><span class="line">	dma_single_init.circular_mode = DMA_CIRCULAR_MODE_ENABLE;	</span><br><span class="line">	<span class="comment">// 数据搬运的方向 内存 -&gt; 外设</span></span><br><span class="line">	dma_single_init.direction = DMA_PERIPH_TO_MEMORY;	</span><br><span class="line">	<span class="comment">// 数据传输的位数，即我们需要发送少多少个（periph_memory_width）大小的数据</span></span><br><span class="line">    <span class="comment">// 这也要等到发送时候才能知道</span></span><br><span class="line">	dma_single_init.number = <span class="number">2U</span>;</span><br><span class="line">	<span class="comment">// 优先级可以默认</span></span><br><span class="line">	dma_single_init.priority = DMA_PRIORITY_HIGH;	</span><br><span class="line"> 	<span class="comment">// DMA 初始化配置</span></span><br><span class="line">	dma_single_data_mode_init(DMA1, DMA_CH0, &amp;dma_single_init);</span><br><span class="line">	<span class="comment">// DMA 通道功能选择</span></span><br><span class="line">	dma_channel_subperipheral_select(DMA1, DMA_CH0, DMA_SUBPERI0);	</span><br><span class="line">	<span class="comment">// 使能DMA1</span></span><br><span class="line">	dma_channel_enable(DMA1, DMA_CH0);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">adc_gpio_config</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">	rcu_periph_clock_enable(RCU_GPIOC);</span><br><span class="line">	gpio_mode_set(GPIOC, GPIO_MODE_ANALOG, GPIO_PUPD_NONE, GPIO_PIN_4);    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取温度和电位器电压</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_mcu_temperature</span><span class="params">(<span class="type">void</span>)</span> &#123;	</span><br><span class="line">	<span class="type">float</span> mcu_dianweiqi = (<span class="number">3.3</span> * dta[<span class="number">0</span>] / <span class="number">4095</span>);	</span><br><span class="line">	<span class="type">float</span> mcu_temperature = (<span class="number">1.45</span> - (<span class="number">3.3</span> * dta[<span class="number">1</span>] / <span class="number">4095</span>)) / (<span class="number">4.1</span> / <span class="number">1000</span>) + <span class="number">25</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;mcu_dianweiqi = %f\n&quot;</span>, mcu_dianweiqi);	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;mcu_temperature = %f\n&quot;</span>, mcu_temperature);	</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意在使用常规通道时候，不要多次清除 EOC 标志位；在多任务时可能会出现数据错误问题；</p>
<p>adc_flag_clear(ADC0, ADC_FLAG_EOC); &#x2F;&#x2F; 清除 EOC 标志位；</p>
<p>adc_routine_data_read(); &#x2F;&#x2F; 读取对应寄存器也会清楚 EOC 标志位；</p>
<p>二者不需要同时存在</p>
</blockquote>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/about/">博主</a></li>
        
          <li><a href="/tags/">标签</a></li>
        
          <li><a href="/categories/">分类</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">1.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%90%E6%AC%A1%E9%80%BC%E8%BF%91%E5%9E%8B%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">逐次逼近型工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">运行模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.</span> <span class="toc-text">同步模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E9%80%9A%E9%81%93%E5%92%8C%E6%B3%A8%E5%85%A5%E9%80%9A%E9%81%93"><span class="toc-number">5.</span> <span class="toc-text">常规通道和注入通道</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AF%B9%E9%BD%90"><span class="toc-number">6.</span> <span class="toc-text">数据对齐</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E6%A1%86%E5%9B%BE"><span class="toc-number">7.</span> <span class="toc-text">模块框图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%80%A7%E8%A1%A8"><span class="toc-number">8.</span> <span class="toc-text">特性表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%A9%E5%BA%A6%E8%AE%A1%E7%AE%97"><span class="toc-number">9.</span> <span class="toc-text">温度计算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.</span> <span class="toc-text">实现</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&text=ADC"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&title=ADC"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&is_video=false&description=ADC"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ADC&body=Check out this article: https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&title=ADC"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&title=ADC"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&title=ADC"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&title=ADC"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&name=ADC&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://www.tooupper.org/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%8D%95%E7%89%87%E6%9C%BA/ARM/Cortex-M4/GD32/GD32F407/ADC/&t=ADC"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2025
    kay
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/about/">博主</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
